# Spring Security defaults behaviour

When we add Spring Boot Security, in our web application by default all the REST endpoints are protected.
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>

<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>
```

When run the web application, we get the default login page, generated by spring security framework.
The below filters responsible for the default login page.
### Default Login Page Display
```java
1. AuthorizationFilter.class
// when we access any endpoint, the `public void doFilter(ServletRequest,  ServletResponse, FilterChain)` will be executed
// Checks the authentication decision for the request, and if the decision is null and not granted, throws an AccessDeniedException.
    try {
            AuthorizationDecision decision = this.authorizationManager.check(this::getAuthentication, request);
            this.eventPublisher.publishAuthorizationEvent(this::getAuthentication, request, decision);
            if (decision != null && !decision.isGranted()) {
            throw new AccessDeniedException("Access Denied");
        }
            chain.doFilter(request, response);
        }
        finally {
            request.removeAttribute(alreadyFilteredAttributeName);
        }
// if the authentication decision is null or notGranted, the request is passed on to the next filter i.e.,    

2. DefaultLoginPageGeneratingFilter.class
// This filter is responsible for generating the default login page. there are other filters involved but mainly these two.

Default login page display flow
    |
    |-> doFilter(req, res, FilterChain) --> AuthorizationFilter
        |
        |-> onAccessDenied("Access Denied") ? then
    | 
    |-> doFilter(req, res, FilterChain) --> DefaultLoginPageGeneratingFilter
        |
        |-> generateLoginPageHtml(req, loginError, logoutSuccess)
```

### Authentication flow 
The below filters responsible for authentication once user enters the credentials on login page

```java
1. AbstractAuthenticationProcessingFilter.class // This is an abstract class 

2. UsernamePasswordAuthenticationFilter.class
// This filter class implements the AbstractAuthenticationProcessingFilter 
// theis gets the username and password from the request and try to authenticate the user
// by calling attemptAuthentication(req, res) method inside this class then, it calls the ProviderManger's authenticate(authentication) method
// where it iterate over all the available AuthenticationProviders and calls the authenticate method of
// AuthenticationProvider interface which is implemented by AbstractUserDetailsAuthenticationProvider, upon calling retriveUser(String username, UsernamePasswordAuthenticationToken authentication)
// calls the DaoAuthenticationProvider's retrieveUser(String username, UsernamePasswordAuthenticationToken authentication) /
// here we call the loadByUserName(username) of UserDetails service to get the user details

Authentication flow
             |
             |-> doFilter() --> AbstractAuthenticationProcessingFilter
             |
             |-> attemptAuthentication(req, res) of UsernamePasswordAuthenticationFilter
             |
             |-> authenticate(authRequest) of ProviderManager implements ProviderManager
             |
             |-> provider.authenticate(authentication) of AbstractUserDetailsAuthenticationProvider
             |
             |-> retrieveUser(username, authentication) of DaoAuthenticationProvider
             |
             |-> loadByUserName(username) of UserDetailsService
             | 
             |-> preAuthenticationChecks.check(user) inside authenticate(Authentication) of AbstractUserDetailsAuthenticationProvider

```